---
title: ""
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    theme: bootstrap
    logo: asu_university_horiz_rgb_white_600.png
    favicon: asu-favicon.ico
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

#This is where you can load packages, clean data, and do any other prep work.

if(!require(ggplot2)){
    install.packages("ggplot2")
    library(ggplot2)
}
if(!require(usmap)){
    install.packages("usmap")
    library(usmap)
}
if(!require(extrafont)){
    install.packages("extrafont")
    library(extrafont)
}
if(!require(leaflet)){
    install.packages("leaflet")
    library(leaflet)
}
if(!require(scales)){
    install.packages("scales")
    library(scales)
}


color_asu_maroon <- ("#8c1d40")
color_asu_gold <- ("#FFC627")
color_asu_green <- ("#78be20")
color_asu_blue <- ("#00A3E0")
color_asu_orange <- ("#ff7f32")
color_asu_grey <- ("#5c6670")
color_asu_black <-("#000000")
color_asu_white <-("#FFFFFF")

#set the standard font
windowsFonts(A = windowsFont("Arial"))

#append them to the standard color pallette
asu_color_pallete<- c(color_asu_maroon, color_asu_orange, color_asu_gold, color_asu_green, color_asu_blue)
```


Row {data-height=600}
-----------------------------------------------------------------------

```{r, out.width = "100%"}


fileInput(inputId="uploaded_file", label="Select Type", multiple=TRUE)
radioButtons(inputId="radio_buttons", label="Compare Vs. ", choices=c( 'The total population','A second list upload'), inline=TRUE)

```



Page 1
============================================================================
Row {data-height=600}
-----------------------------------------------------------------------
### Geologic Map
```{r}
renderPlot({
library(usmap)
library(ggplot2)

  infile <- input$uploaded_file
if(is.null(infile))
{
  return(NULL)
}
data=read.csv(infile$datapath)
#set the min data size to 50 for final version
min_data_size <- 1
if(length(data) < min_data_size)
{
  return(NULL)
}
states=data['state']
state_pop <- as.data.frame(table(states))
#convert the col to a char type
state_pop[1] <- sapply(state_pop[,1],as.character)
colnames(state_pop) <- c("state", "pop")
state_pop

plot_usmap(data =state_pop , values = "pop", lines = "red") +
  scale_fill_continuous(
    low=color_asu_grey,high=color_asu_maroon, name = "Population (2015)", label = scales::comma
  ) + theme(legend.position = "right")

})

```

Row
-----------------------------------------------------------------------

### Density by State

```{r}
renderPlot({

  infile <- input$uploaded_file
if(is.null(infile))
{
  return(NULL)
}
raw_data=read.csv(infile$datapath)
param='state'
title='Density by State'

        #trim the data by creating a subset from the colnames
        trimmed <- subset(raw_data, select=c(param))

        #convert the data to a data frame to ease manipulation
        trimmed <- as.data.frame(trimmed)

        #find the rows with empty vals and set them to NA
        trimmed[trimmed==""] <- NA

        #exlude the NA vals from the data set
        trimmed <- na.omit(trimmed)

        #convert the df to a table to count the number of occurances, and then back to a df
        trimmed_data <- as.data.frame(table(trimmed))

        #clean the data again
        trimmed_data[trimmed_data==""] <- NA
        trimmed_data <- na.omit(trimmed_data)

        #change the data type of the first col
        trimmed_data[,1] <- sapply(trimmed_data[,1], as.character)

        #rename the first col to metrics
        names(trimmed_data)[1] <- "metrics"

        trimmed_data
        #get a vector of the names of all metrics
        names <- trimmed_data[,1]
        #get a vector of the values of the metrics
        values <- trimmed_data[,2]

        pct <- round(values/sum(values)*100)
        #add percentages to the labels
        names <- paste(names,pct)
        names <- paste(names, "%", sep="")#add % to labels


        #plot the pie chart
        pie(family="A",values, labels = names, main=title, col=asu_color_pallete, edges= 200, clockwise=TRUE)


})


```


Page 2
============================================================================
Row
-----------------------------------------------------------------------
### Plot2.1
```{r}
renderPlot({
    infile <- input$uploaded_file
  if(is.null(infile))
  {
    return(NULL)
  }
  data=read.csv(infile$datapath)
  #set the min data size to 50 for final version
  min_data_size <- 1
  if(length(data) < min_data_size)
  {
    return(NULL)
  }
  states=data['state']
  state_pop <- as.data.frame(table(states))
  #convert the col to a char type
  state_pop[1] <- sapply(state_pop[,1],as.character)
  colnames(state_pop) <- c("state", "pop")
  state_pop
  plot(state_pop['pop'])

})

```


Column {data-width=350}
-----------------------------------------------------------------------

### Plot2.2

```{r}
renderPlot({
    infile <- input$uploaded_file
  if(is.null(infile))
  {
    return(NULL)
  }
  data=read.csv(infile$datapath)
  #set the min data size to 50 for final version
  min_data_size <- 1
  if(length(data) < min_data_size)
  {
    return(NULL)
  }
  states=data['state']
  state_pop <- as.data.frame(table(states))
  #convert the col to a char type
  state_pop[1] <- sapply(state_pop[,1],as.character)
  colnames(state_pop) <- c("state", "pop")
  state_pop
    plot(state_pop['pop'])

})

```

### Plot2.3

```{r}
renderPlot({
    infile <- input$uploaded_file
  if(is.null(infile))
  {
    return(NULL)
  }
  data=read.csv(infile$datapath)
  #set the min data size to 50 for final version
  min_data_size <- 1
  if(length(data) < min_data_size)
  {
    return(NULL)
  }
  states=data['state']
  state_pop <- as.data.frame(table(states))
  #convert the col to a char type
  state_pop[1] <- sapply(state_pop[,1],as.character)
  colnames(state_pop) <- c("state", "pop")
  state_pop
  plot(state_pop['pop'])

})
```


Page 3
============================================================================

Row
-----------------------------------------------------------------------
### Plot 3.1
```{r}
renderPlot({
    infile <- input$uploaded_file
  if(is.null(infile))
  {
    return(NULL)
  }
  data=read.csv(infile$datapath)
  #set the min data size to 50 for final version
  min_data_size <- 1
  if(length(data) < min_data_size)
  {
    return(NULL)
  }
  states=data['state']
  state_pop <- as.data.frame(table(states))
  #convert the col to a char type
  state_pop[1] <- sapply(state_pop[,1],as.character)
  colnames(state_pop) <- c("state", "pop")
  state_pop
  plot(state_pop['pop'])

})

```


<style>

.navbar-logo img {
height: 48px;


}


.navbar-inverse {
  background-color: #353535;
  border-color: #353535;
  text-color: #ffffff;
    font-size: 16px;
    font-weight: bold;
    border: none;
}


.navbar-inverse .navbar-text {
  background-color: #353535;
  border-color: #353535;
  color: #ffffff;
    font-size: 16px;
    font-weight: bold;
    border: none;
}
.navbar-inverse .navbar-nav > li > a {
  background-color: #353535;
  border-color: #353535;
  color: #ffffff;
    font-size: 16px;
    font-weight: bold;
    border: none;
}
.navbar-inverse .navbar-nav > li > a:hover,
.navbar-inverse .navbar-nav > li > a:focus {
  background: #1f1f1f;
    color: #ffb130;
    font-size: 16px;
    font-weight: bold;
    border: none;
}
.navbar-inverse .navbar-nav > .active > a,
.navbar-inverse .navbar-nav > .active > a:hover,
.navbar-inverse .navbar-nav > .active > a:focus {
  background: #1f1f1f;
    color: #ffb130;
    font-size: 16px;
    font-weight: bold;
    border: none;
}
.navbar-inverse .navbar-nav > .disabled > a,
.navbar-inverse .navbar-nav > .disabled > a:hover,
.navbar-inverse .navbar-nav > .disabled > a:focus {
  background: #1f1f1f;
    color: #ffb130;
    font-size: 16px;
    font-weight: bold;
    border: none;
}

body {
  padding-top: 0px;
}

.shiny-output-error { visibility: hidden; }
.shiny-output-error:before { visibility: hidden; }


</style>
